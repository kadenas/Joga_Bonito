<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0B2C5F"/>
  <link rel="manifest" href="/manifest.webmanifest"/>
  <title>Astillero Idle</title>
  <style>
    :root{
      --bg:#061e3c; --panel:#0b2c5f; --accent:#ff8c00; --ink:#e6f1ff;
      --muted:#5f7aa1; --chip:#123867;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 50% -20%,#103a72 0,#061e3c 60%,#051528 100%);
         color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
         min-height:100vh;display:flex;flex-direction:column}
    header,footer{display:flex;justify-content:center;align-items:center;padding:16px 12px}
    header h1{letter-spacing:2px;margin:0;font-size:28px}
    footer{font-size:14px;opacity:.7}
    main{width:100%;max-width:900px;margin:0 auto;padding:12px 16px 48px;display:grid;gap:18px}
    .card{background:var(--panel);border-radius:16px;padding:16px;box-shadow:0 14px 32px rgba(0,0,0,.32)}
    #hud{text-align:center;display:grid;gap:10px}
    #contador{font-size:40px;font-weight:800}
    #jps{opacity:.85}
    .meter{height:12px;border-radius:999px;background:#112f55;overflow:hidden;position:relative}
    .meter>.bar{position:absolute;inset:0;background:linear-gradient(90deg,#ffd964 0%,var(--accent) 100%);width:0%;transition:width .2s ease}
    #bonusText{font-size:14px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .btn{display:block;width:100%;padding:14px 16px;border-radius:14px;border:0;font-weight:700;font-size:18px;
         box-shadow:0 12px 0 rgba(0,0,0,.25);cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}
    .btn.primary{background:var(--accent);color:#201408}
    .btn.secondary{background:#123867;color:var(--ink)}
    .btn:active{transform:translateY(3px);box-shadow:0 4px 0 rgba(0,0,0,.32)}
    .btn:disabled{opacity:.55;box-shadow:none;transform:none;cursor:not-allowed}
    h2{margin:12px 0 0;letter-spacing:.2em;font-size:16px;text-transform:uppercase;color:var(--muted)}
    /* Dársena */
    #darsenaWrap{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:860px){#darsenaWrap{grid-template-columns:minmax(0,2fr) minmax(200px,1fr)}}
    #darsena{background:var(--panel);border-radius:18px;padding:16px;box-shadow:0 14px 32px rgba(0,0,0,.32);position:relative}
    #dock{display:grid;gap:14px;position:relative;z-index:0}
    .row{position:relative;height:104px;border-radius:14px;background:#0f355f;overflow-x:auto;overflow-y:hidden;z-index:0}
    .row .tokens{position:relative;white-space:nowrap;padding:16px 12px;display:inline-flex;align-items:flex-end}
    .row::-webkit-scrollbar{height:6px}
    .row::-webkit-scrollbar-thumb{background:rgba(230,241,255,.25);border-radius:3px}
    .row .tokens::after{content:"";display:block;width:12px;height:1px}
    .label-row{position:absolute;left:16px;top:12px;font-size:12px;letter-spacing:.14em;text-transform:uppercase;color:rgba(230,241,255,.6)}
    .water{position:absolute;inset:0;opacity:.18;background:linear-gradient(0deg,rgba(255,255,255,.0) 0%,rgba(255,255,255,.2) 100%);
      mask:radial-gradient(60px 12px at 0 60%,#000 98%,transparent 102%) repeat-x;animation:waterShift 14s linear infinite;pointer-events:none}
    .token{display:inline-flex;width:64px;height:64px;margin:0 10px;justify-content:center;align-items:center;transform-origin:32px 48px}
    .token:first-child{margin-left:0}
    .token svg{width:64px;height:64px}
    .ship{animation:bob 3.2s ease-in-out infinite}
    .worker{animation:bob 2.2s ease-in-out infinite}
    .crane{animation:tilt 4s ease-in-out infinite}
    .summary{background:var(--panel);border-radius:18px;padding:18px;box-shadow:0 14px 32px rgba(0,0,0,.32);display:grid;gap:12px;height:fit-content}
    .summary h3{margin:0;font-size:15px;letter-spacing:.18em;text-transform:uppercase;color:rgba(230,241,255,.7)}
    .badge{display:grid;grid-template-columns:1fr auto;gap:6px;align-items:center;background:#102f57;border-radius:14px;padding:12px 14px}
    .badge .k{font-size:20px;font-weight:700;color:#bcd1f6}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background:var(--chip);font-size:12px;
          letter-spacing:.08em;text-transform:uppercase;color:rgba(230,241,255,.85)}
    /* Paneles secundarios */
    .panel{background:var(--panel);border-radius:18px;padding:18px;box-shadow:0 14px 32px rgba(0,0,0,.32)}
    .upgrades{display:grid;gap:14px}
    .upgrade{background:#102f57;border-radius:16px;padding:14px;display:grid;gap:10px}
    .upgrade header{display:flex;justify-content:space-between;align-items:baseline;gap:12px}
    .upgrade header h3{margin:0;font-size:16px}
    .upgrade header .badge{background:#123867;padding:6px 10px;font-size:12px;border-radius:999px;display:inline-flex;grid-template-columns:none;gap:6px}
    .upgrade p{margin:0;font-size:14px;color:rgba(230,241,255,.8)}
    .upgrade .btn{display:inline-flex;align-items:center;justify-content:center;width:auto;justify-self:end;padding:10px 16px;
      font-size:15px;box-shadow:0 8px 0 rgba(0,0,0,.2)}
    .settings{display:grid;gap:12px}
    .settings h2{margin:0;font-size:16px;letter-spacing:.18em;text-transform:uppercase;color:var(--muted)}
    .settings label{display:flex;justify-content:space-between;align-items:center;background:#102f57;padding:12px 16px;border-radius:14px;font-size:14px}
    .settings .grid{display:grid;gap:10px}
    textarea{width:100%;min-height:140px;border-radius:12px;border:1px solid rgba(230,241,255,.25);background:#071a33;color:var(--ink);padding:12px;font-family:monospace}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,7,16,.72);backdrop-filter:blur(4px);padding:16px;z-index:30}
    .modal.active{display:flex}
    .modal-content{background:#091b36;border-radius:18px;padding:20px;display:grid;gap:12px;max-width:420px;width:100%}
    .shop{background:var(--panel);border-radius:14px;padding:16px;box-shadow:0 12px 24px rgba(0,0,0,.28);display:grid;gap:12px;position:relative;z-index:1000}
    .shop *{pointer-events:auto;}
    .shop h2{margin:0;font-size:16px;letter-spacing:.18em;text-transform:uppercase;color:var(--muted)}
    .item{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;background:#0f355f;padding:12px;border-radius:12px}
    .item h3{margin:0;font-size:16px}
    .item p{margin:2px 0 0;font-size:13px;opacity:.85}
    .price{font-weight:800;background:#123867;padding:8px 12px;border-radius:10px}
    .buy{border:0;border-radius:10px;padding:10px 14px;background:var(--accent);color:#1b160c;font-weight:800;cursor:pointer;box-shadow:0 6px 0 rgba(0,0,0,.25)}
    .buy[disabled]{opacity:.4;filter:grayscale(40%);cursor:not-allowed;box-shadow:none}
    .level{opacity:.8;font-size:12px;font-weight:600;margin-left:6px}
    .row2{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    @keyframes bob{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-3px) rotate(-.3deg)}100%{transform:translateY(0) rotate(0)}}
    @keyframes tilt{0%,100%{transform:rotate(0)}50%{transform:rotate(-1.2deg)}}
    @keyframes waterShift{from{background-position-x:0}to{background-position-x:-260px}}
  </style>
</head>
<body>
  <header><h1>ASTILLERO IDLE</h1></header>
  <main>
    <section class="card" id="hud">
      <div id="contador" aria-live="polite">0</div>
      <div id="jps">0 Jornales/s</div>
      <div class="meter" aria-hidden="true"><div class="bar" id="bonusBar"></div></div>
      <div id="bonusText">Marea viva lista</div>
    </section>
    <button class="btn primary" id="btnTap">Remachar casco</button>
    <button class="btn secondary" id="btnBonus">Marea viva</button>

    <h2>DÁRSENA</h2>
    <div id="darsenaWrap">
      <section id="darsena" aria-labelledby="dock-title">
        <h3 id="dock-title" style="position:absolute;left:-9999px;top:auto">Estado visual del astillero</h3>
        <div class="dock" id="dock">
          <div class="row" id="row-barcos" role="group" aria-label="Barcos en reparación">
            <span class="label-row">Barcos en reparación</span>
            <div class="water" aria-hidden="true"></div>
            <div class="tokens" role="list"></div>
          </div>
          <div class="row" id="row-obreros" role="group" aria-label="Aprendices en el muelle">
            <span class="label-row">Aprendices</span>
            <div class="water" aria-hidden="true"></div>
            <div class="tokens" role="list"></div>
          </div>
          <div class="row" id="row-gruas" role="group" aria-label="Grúas y equipo">
            <span class="label-row">Grúas y equipo</span>
            <div class="water" aria-hidden="true"></div>
            <div class="tokens" role="list"></div>
          </div>
        </div>
      </section>
      <aside class="summary" aria-labelledby="summary-title">
        <h3 id="summary-title">Resumen del astillero</h3>
        <div class="badge"><span>Barcos</span><span class="k" id="sum-barcos">0</span></div>
        <div class="badge"><span>Obreros</span><span class="k" id="sum-obreros">0</span></div>
        <div class="badge"><span>Grúas</span><span class="k" id="sum-gruas">0</span></div>
      </aside>
    </div>

    <section class="shop" id="shop">
      <h2>MEJORAS</h2>
      <div id="shopList" aria-live="polite"></div>
    </section>

    <section class="panel settings">
      <h2>Ajustes</h2>
      <label>Audio <input type="checkbox" id="audioToggle" checked></label>
      <label>Vibración <input type="checkbox" id="vibrationToggle" checked></label>
      <div class="grid">
        <button class="btn secondary" id="exportButton" type="button">Exportar progreso</button>
        <button class="btn secondary" id="importButton" type="button">Importar progreso</button>
      </div>
    </section>
  </main>
  <footer>v1.1.0 — Dársena SVG animada</footer>

  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <h3 id="modalTitle">Exportar progreso</h3>
      <textarea id="modalTextarea" readonly></textarea>
      <div class="grid" style="display:grid;gap:10px">
        <button class="btn secondary" id="modalCopy" type="button">Copiar</button>
        <button class="btn secondary" id="modalClose" type="button">Cerrar</button>
      </div>
    </div>
  </div>

  <svg id="sprite-defs" width="0" height="0" aria-hidden="true" style="position:absolute">
    <defs>
      <linearGradient id="hullGrad" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="#FF9A1A"/>
        <stop offset="100%" stop-color="#FF8C00"/>
      </linearGradient>
    </defs>
    <symbol id="ship-hull" viewBox="0 0 64 64">
      <path d="M6 42 L58 42 L52 52 L12 52 Z" fill="url(#hullGrad)" stroke="#0B2C5F" stroke-width="2"/>
      <rect x="10" y="48" width="44" height="4" fill="#0B2C5F"/>
    </symbol>
    <symbol id="ship-cabin" viewBox="0 0 64 64">
      <rect x="24" y="30" width="16" height="10" rx="2" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="2"/>
      <circle cx="30" cy="35" r="1.5" fill="#0B2C5F"/>
      <circle cx="34" cy="35" r="1.5" fill="#0B2C5F"/>
      <circle cx="38" cy="35" r="1.5" fill="#0B2C5F"/>
    </symbol>
    <symbol id="ship-mast" viewBox="0 0 64 64">
      <rect x="31" y="18" width="2" height="16" fill="#0B2C5F"/>
      <path d="M33 18 L48 28 L33 28 Z" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="1"/>
    </symbol>
    <symbol id="crane" viewBox="0 0 64 64">
      <rect x="8" y="40" width="10" height="12" fill="#0B2C5F"/>
      <rect x="13" y="20" width="4" height="20" fill="#0B2C5F"/>
      <rect x="17" y="22" width="28" height="4" fill="#0B2C5F"/>
      <rect x="40" y="24" width="2" height="14" fill="#0B2C5F"/>
      <circle cx="41" cy="40" r="2" fill="#FF8C00"/>
    </symbol>
    <symbol id="worker" viewBox="0 0 64 64">
      <circle cx="24" cy="24" r="6" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="2"/>
      <rect x="18" y="30" width="12" height="14" rx="3" fill="#0B2C5F"/>
      <rect x="30" y="32" width="14" height="4" fill="#0B2C5F"/>
      <rect x="42" y="20" width="6" height="6" fill="#FF8C00"/>
    </symbol>
  </svg>

  <!-- Carga del entrypoint como módulo con versión para evitar caché SW -->
  <script type="module" src="/src/main.js?v=8"></script>
  <script>
    // Registro del SW (si falla, no bloquea el juego)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js?v=8').catch(()=>{});
    }
  </script>
</body>
</html>
