<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no"/>
  <meta name="theme-color" content="#0B2C5F"/>
  <link rel="manifest" href="/manifest.webmanifest"/>
  <title>Varadero Mosquera</title>
  <style>
    :root{
      --bg:#061e3c; --panel:#0b2c5f; --accent:#ff8c00; --ink:#e6f1ff; --muted:#5f7aa1;
      --chip:#123867; --radius:18px; --pad:clamp(12px,3vw,22px);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; background:radial-gradient(1200px 600px at 50% -20%,#103a72 0,#061e3c 60%,#051528 100%);
      color:var(--ink); font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      display:flex; flex-direction:column; padding-top:env(safe-area-inset-top);
    }
    header,main,footer{width:100%; max-width:1024px; margin-inline:auto; padding-inline:var(--pad);}
    header,footer{display:flex; justify-content:center; text-align:center; padding-block:18px 12px;}
    header h1{letter-spacing:.26em; margin:0; font-size:clamp(18px,5vw,30px);}
    footer{opacity:.7; font-size:clamp(12px,3vw,16px); padding-bottom:calc(18px + env(safe-area-inset-bottom,0px));}
    main{flex:1; display:grid; gap:clamp(16px,3vw,26px); padding-block:clamp(18px,4vw,32px);}

    .card, details{background:var(--panel); border-radius:var(--radius); box-shadow:0 16px 34px rgba(0,0,0,.32); overflow:hidden;}
    #hud{display:grid; gap:16px; justify-items:center; text-align:center; padding:clamp(24px,4vw,36px); position:relative;}
    #hudActions{position:absolute; top:12px; right:12px; display:flex; gap:8px;}
    #hudActions button{border:0; background:#123867; color:#e6f1ff; border-radius:12px; padding:8px 10px; font-weight:800; cursor:pointer;}
    #hudActions button:focus-visible{outline:3px solid rgba(255,255,255,.6); outline-offset:3px;}
    #contador{font-size:clamp(28px,9vw,46px); font-weight:800;}
    #jps{opacity:.9; font-size:clamp(14px,4vw,18px);}
    .meter{width:100%; height:14px; border-radius:999px; background:#112f55; overflow:hidden; position:relative;}
    .meter>.bar{position:absolute; inset:0; background:linear-gradient(90deg,#ffd964 0%,var(--accent) 100%); width:0%; transition:width .25s ease;}
    #bonusText{font-size:clamp(12px,3.5vw,15px); letter-spacing:.08em; text-transform:uppercase; color:var(--muted);}
    #btnBonus{width:min(220px,100%); border:0; border-radius:14px; padding:12px 14px; font-weight:800; font-size:clamp(14px,4vw,16px);
      text-transform:uppercase; letter-spacing:.06em; background:linear-gradient(180deg,#ffd964 0%,var(--accent) 100%); color:#201408;
      box-shadow:0 10px 0 rgba(0,0,0,.35); cursor:pointer; transition:transform .12s ease,box-shadow .12s ease;}
    #btnBonus:disabled{opacity:.6; cursor:not-allowed; box-shadow:none;}
    #btnBonus:active{transform:translateY(3px); box-shadow:0 4px 0 rgba(0,0,0,.35);}

    #tapBoat{position:relative; border:0; background:none; padding:0; touch-action:manipulation; width:clamp(120px,40vw,240px);
      aspect-ratio:1; border-radius:50%; background:radial-gradient(circle at 50% 45%,rgba(230,241,255,.18) 0,rgba(11,44,95,.8) 70%,rgba(4,16,35,.85) 100%);
      box-shadow:0 18px 40px rgba(0,0,0,.45); display:grid; place-items:center; cursor:pointer; animation:bobTap 4s ease-in-out infinite;
      transition:transform .18s ease;}
    #tapBoat:focus-visible{outline:3px solid rgba(255,255,255,.6); outline-offset:6px;}
    #tapBoat svg{width:68%; height:68%; pointer-events:none;}
    #tapFx{position:absolute; inset:0; pointer-events:none; overflow:visible; z-index:6;}
    .tapFloat{position:absolute; color:#ffd27a; font-weight:900; font-size:clamp(22px,6vw,38px); letter-spacing:.02em; pointer-events:none;
      transform:translate(-50%,-18%); animation:floatUp .85s ease-out forwards; text-shadow:0 2px 0 rgba(0,0,0,.65);}
    @keyframes floatUp{to{transform:translate(-50%,-60px); opacity:0;}}
    .bolt{position:absolute; width:8px; height:8px; border-radius:2px; background:#FF8C00; box-shadow:0 0 0 1px #0B2C5F inset,0 0 8px rgba(255,140,0,.35);
      pointer-events:none; transform:translate(0,0) rotate(0deg); opacity:1; animation:boltFly 720ms ease-out forwards;}
    .bolt.r1{width:6px;height:6px;} .bolt.r2{width:10px;height:10px;border-radius:3px;}
    @keyframes boltFly{to{transform:translate(var(--dx),calc(-1 * var(--dy))) rotate(var(--rot));opacity:0;}}
    @keyframes bobTap{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

    details>summary{padding:18px 22px; font-size:clamp(16px,4.4vw,20px); letter-spacing:.12em; text-transform:uppercase; color:rgba(230,241,255,.85); cursor:pointer; list-style:none;}
    details>summary::-webkit-details-marker{display:none;}
    details[open]>summary{border-bottom:1px solid rgba(230,241,255,.12);}
    .panel-body{padding:clamp(16px,4vw,26px); display:grid; gap:16px;}

    #dock{display:grid; gap:12px;}
    #dock.flash{box-shadow:0 0 24px rgba(255,140,0,.35); transition:box-shadow .4s;}
    #dockPanel .lane{display:grid; gap:12px; padding:12px 14px; background:#0f355f; border-radius:14px; box-shadow:inset 0 0 0 1px rgba(230,241,255,.12);}
    #dockPanel .lane strong{font-size:14px; letter-spacing:.12em; text-transform:uppercase; color:rgba(230,241,255,.7);}
    #dockPanel .lane .row{display:flex; flex-wrap:wrap; gap:8px; align-items:center; min-height:32px;}
    .ship,.worker,.crane{width:22px; height:22px; flex:0 0 auto;}

    .shop{background:#102f57; border-radius:16px; padding:18px; display:grid; gap:16px;}
    .shop h2{margin:0; font-size:16px; letter-spacing:.16em; text-transform:uppercase; color:var(--muted);}
    .item{display:grid; gap:10px; align-items:center; background:#0f355f; padding:14px; border-radius:14px;}
    .item h3{margin:0; font-size:16px; display:flex; flex-wrap:wrap; gap:6px; align-items:center;}
    .item p{margin:4px 0 0; font-size:14px; opacity:.85;}
    .row2{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap;}
    .price{font-weight:800; background:#123867; padding:8px 12px; border-radius:12px;}
    .buy{border:0; border-radius:12px; padding:10px 16px; background:linear-gradient(180deg,#ffb347 0%,var(--accent) 100%); color:#1b160c;
      font-weight:800; cursor:pointer; box-shadow:0 6px 0 rgba(0,0,0,.25); transition:transform .12s ease,box-shadow .12s ease;}
    .buy:active{transform:translateY(2px); box-shadow:0 2px 0 rgba(0,0,0,.25);} .buy[disabled]{opacity:.4; box-shadow:none; cursor:not-allowed;}
    .item.locked{background:#0b2850; opacity:.65; filter:grayscale(.15);} .item.locked .price{background:#162f55;}
    .level{font-size:13px; font-weight:700; opacity:.8;}

    #achList{display:grid; gap:12px;}
    .ach{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; background:#0f355f; padding:12px; border-radius:12px;}
    .ach .state{font-weight:800; padding:6px 12px; border-radius:12px; background:#123867; letter-spacing:.04em;}
    .ach.locked{opacity:.6;} .ach .desc{opacity:.85; font-size:13px; margin-top:4px;}

    .toast{position:fixed; inset:auto 12px calc(12px + env(safe-area-inset-bottom,12px)) 12px; margin:auto; max-width:520px; background:#123867;
      color:#e6f1ff; border-radius:14px; padding:12px; box-shadow:0 12px 0 rgba(0,0,0,.35); animation:slideUp .25s ease-out; z-index:2000;}
    @keyframes slideUp{from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1}}
    .toast h4{margin:0 0 6px; font-size:16px;} .toast .row{display:flex; gap:8px; justify-content:flex-end;}
    .toast .btn{width:auto; margin:0; background:#123867; color:var(--ink);}

    .btn{display:block; width:100%; padding:14px 16px; border-radius:14px; border:0; font-weight:700; font-size:18px;
      box-shadow:0 12px 0 rgba(0,0,0,.25); cursor:pointer; transition:transform .12s ease,box-shadow .12s ease;}
    .btn:active{transform:translateY(3px); box-shadow:0 4px 0 rgba(0,0,0,.32);} .btn:disabled{opacity:.55; box-shadow:none; cursor:not-allowed;}

    #bottomBar{position:sticky; bottom:0; left:0; right:0; display:flex; gap:12px; padding:12px env(safe-area-inset-right,16px) calc(12px + env(safe-area-inset-bottom,8px)) env(safe-area-inset-left,16px);
      background:rgba(4,18,36,.9); backdrop-filter:blur(18px); box-shadow:0 -8px 24px rgba(0,0,0,.45); z-index:40;}
    #bottomBar .btn{flex:1; min-height:48px; border-radius:16px; font-size:clamp(14px,4vw,16px); text-transform:uppercase; letter-spacing:.08em;}
    #bottomBar button[aria-current="true"]{filter:brightness(1.15);}

    @media (min-width:768px){
      main{grid-template-columns:minmax(0,1fr);}
      #hud{grid-template-columns:repeat(2,minmax(0,1fr)); align-items:center; text-align:left; justify-items:flex-start;}
      #hud .meter,#hud #bonusText{grid-column:1/3;}
      #tapBoat{justify-self:center;}
      #dockPanel .lane{grid-template-columns:220px 1fr; align-items:center;}
    }

    @media (max-width:480px){
      header h1{font-size:clamp(18px,6vw,24px);} #hud #contador{font-size:clamp(26px,10vw,40px);} #hud #jps{font-size:clamp(14px,4.5vw,16px);}
    }

    @media (prefers-reduced-motion:reduce){
      *,*::before,*::after{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important;}
    }
  </style>
</head>
<body>
  <header><h1>Varadero Mosquera</h1></header>
  <main>
    <section class="card" id="hud">
      <div id="hudActions">
        <button id="muteBtn" type="button" aria-pressed="false" title="Sonido">🔊</button>
        <button id="btnReset" type="button" title="Reiniciar partida">⟲</button>
      </div>
      <div id="contador" aria-live="polite">0</div>
      <div id="jps">0 Jornales/s</div>
      <button id="tapBoat" aria-label="Remachar casco" type="button">
        <svg viewBox="0 0 96 96" aria-hidden="true" focusable="false">
          <use href="#ship-hull"></use>
          <use href="#ship-cabin"></use>
          <use href="#ship-mast"></use>
        </svg>
        <div id="tapFx" aria-hidden="true"></div>
      </button>
      <div class="meter" aria-hidden="true"><div class="bar" id="bonusBar"></div></div>
      <div id="bonusText">Marea viva lista</div>
      <button id="btnBonus" type="button">Marea viva</button>
    </section>

    <details id="dockPanel" open>
      <summary>Dársena</summary>
      <div class="panel-body">
        <div id="dock">
          <div class="lane">
            <strong>Barcos en reparación</strong>
            <div class="row" id="dockShips" aria-live="polite"></div>
          </div>
          <div class="lane">
            <strong>Aprendices</strong>
            <div class="row" id="dockWorkers" aria-live="polite"></div>
          </div>
          <div class="lane">
            <strong>Grúas y equipo</strong>
            <div class="row" id="dockCranes" aria-live="polite"></div>
          </div>
        </div>
      </div>
    </details>

    <details id="shopPanel" open>
      <summary>Mejoras</summary>
      <div class="panel-body">
        <section class="shop" id="shop" aria-labelledby="shopHeading">
          <h2 id="shopHeading">Catálogo de mejoras</h2>
          <div id="shopList" aria-live="polite"></div>
        </section>
      </div>
    </details>

    <details id="achPanel">
      <summary>Logros <span id="achCount" style="opacity:.8"></span></summary>
      <div class="panel-body">
        <div id="achList" aria-live="polite"></div>
        <h3 style="margin:12px 0 0">Exportar / Importar progreso</h3>
        <div class="controls" style="display:flex;gap:8px;flex-wrap:wrap;">
          <button id="btnExport" class="btn" type="button">Exportar</button>
          <button id="btnImport" class="btn" type="button">Importar</button>
        </div>
        <textarea id="exportBox" style="width:100%;min-height:140px;border-radius:12px;border:1px solid rgba(230,241,255,.25);background:#071a33;color:var(--ink);padding:12px;font-family:monospace" placeholder="Aquí verás el JSON al exportar o pega aquí para importar"></textarea>
      </div>
    </details>
  </main>
  <footer>v1.3.0 — Astillero en movimiento</footer>

  <nav id="bottomBar" aria-label="Acciones principales">
    <button type="button" class="btn" id="nav-dock">DÁRSENA</button>
    <button type="button" class="btn" id="nav-shop">TIENDAS</button>
    <button type="button" class="btn" id="nav-ach">LOGROS</button>
  </nav>

  <svg id="sprite-defs" width="0" height="0" aria-hidden="true" style="position:absolute">
    <defs>
      <linearGradient id="hullGrad" x1="0" x2="0" y1="0" y2="1">
        <stop offset="0%" stop-color="#FF9A1A"/>
        <stop offset="100%" stop-color="#FF8C00"/>
      </linearGradient>
    </defs>
    <symbol id="ship-hull" viewBox="0 0 64 64">
      <path d="M6 42 L58 42 L52 52 L12 52 Z" fill="url(#hullGrad)" stroke="#0B2C5F" stroke-width="2"/>
      <rect x="10" y="48" width="44" height="4" fill="#0B2C5F"/>
    </symbol>
    <symbol id="ship-cabin" viewBox="0 0 64 64">
      <rect x="24" y="30" width="16" height="10" rx="2" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="2"/>
      <circle cx="30" cy="35" r="1.5" fill="#0B2C5F"/>
      <circle cx="34" cy="35" r="1.5" fill="#0B2C5F"/>
      <circle cx="38" cy="35" r="1.5" fill="#0B2C5F"/>
    </symbol>
    <symbol id="ship-mast" viewBox="0 0 64 64">
      <rect x="31" y="18" width="2" height="16" fill="#0B2C5F"/>
      <path d="M33 18 L48 28 L33 28 Z" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="1"/>
    </symbol>
    <symbol id="crane" viewBox="0 0 64 64">
      <rect x="8" y="40" width="10" height="12" fill="#0B2C5F"/>
      <rect x="13" y="20" width="4" height="20" fill="#0B2C5F"/>
      <rect x="17" y="22" width="28" height="4" fill="#0B2C5F"/>
      <rect x="40" y="24" width="2" height="14" fill="#0B2C5F"/>
      <circle cx="41" cy="40" r="2" fill="#FF8C00"/>
    </symbol>
    <symbol id="worker" viewBox="0 0 64 64">
      <circle cx="24" cy="24" r="6" fill="#E6F1FF" stroke="#0B2C5F" stroke-width="2"/>
      <rect x="18" y="30" width="12" height="14" rx="3" fill="#0B2C5F"/>
      <rect x="30" y="32" width="14" height="4" fill="#0B2C5F"/>
      <rect x="42" y="20" width="6" height="6" fill="#FF8C00"/>
    </symbol>
  </svg>

  <div id="popupRoot" aria-live="polite" aria-atomic="true"></div>
  <script type="module" src="/src/main.js?v=24"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js?v=24').catch(()=>{});
    }
  </script>
</body>
</html>
